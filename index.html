<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, BigData" />








  <link rel="shortcut icon" type="image/x-icon" href="/images/wei.png?v=5.1.0" />






<meta name="description" content="时间渐行渐远">
<meta property="og:type" content="website">
<meta property="og:title" content="Time渐行渐远">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Time渐行渐远">
<meta property="og:description" content="时间渐行渐远">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Time渐行渐远">
<meta name="twitter:description" content="时间渐行渐远">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title> Time渐行渐远 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Time渐行渐远</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Coding Changing The World</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/19/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Hushiwei">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/wei.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Time渐行渐远">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/19/hello-world/" itemprop="url">
                  Hello World
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-19T17:00:00+08:00">
                2016-12-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/helloworld/" itemprop="url" rel="index">
                    <span itemprop="name">helloworld</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/12/19/hello-world/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/19/hello-world/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/19/2016-12-19-SparkBug/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Hushiwei">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/wei.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Time渐行渐远">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/19/2016-12-19-SparkBug/" itemprop="url">
                  spark开发中遇到的问题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-19T17:00:00+08:00">
                2016-12-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/spark/" itemprop="url" rel="index">
                    <span itemprop="name">spark</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/12/19/2016-12-19-SparkBug/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/19/2016-12-19-SparkBug/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="spark连接mysql"><a href="#spark连接mysql" class="headerlink" title="spark连接mysql"></a>spark连接mysql</h2><ul>
<li><p>问题描述</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">总是报no suitable driver以及   jdbc.mysql.driver类似这样的错误</div></pre></td></tr></table></figure>
</li>
<li><p>解决办法1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">1.提交任务的时候带上这个，手动指定mysql jar包的位置</div><div class="line">                    SPARK_CLASSPATH=/usr/local/spark-1.4.1-bin-hadoop2.6/lib/mysql-connector-java-5.1.38.jar ./bin/spark-submit --class sparkDemo /root/data/demon-parent-1.0-SNAPSHOT-jar-with-dependencies.jar hdfs://192.168.119.100:9000/examples/custom.txt</div></pre></td></tr></table></figure>
</li>
<li><p>解决办法2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">修改了这个配置SPARK_HOME/conf/spark-env.sh文件，在里面加上了这个参数，就OK了</div><div class="line"></div><div class="line">export SPARK_CLASSPATH=$SPATH_CLASSPATH:/usr/hdp/2.4.0.0-169/spark/lib/mysql-connector-java-5.1.38.jar</div></pre></td></tr></table></figure></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/15/2016-12-15-FlaskMail/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Hushiwei">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/wei.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Time渐行渐远">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/15/2016-12-15-FlaskMail/" itemprop="url">
                  Flask框架中用QQ邮箱发邮件
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-15T17:00:00+08:00">
                2016-12-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/flask/" itemprop="url" rel="index">
                    <span itemprop="name">flask</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/12/15/2016-12-15-FlaskMail/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/15/2016-12-15-FlaskMail/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="配置信息，看注释"><a href="#配置信息，看注释" class="headerlink" title="配置信息，看注释"></a>配置信息，看注释</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">basedir = os.path.abspath(os.path.dirname(__file__))</div><div class="line"></div><div class="line">app = Flask(__name__)</div><div class="line">app.config[&apos;SECRET_KEY&apos;] = &apos;hard to guess string&apos;</div><div class="line">app.config[&apos;SQLALCHEMY_DATABASE_URI&apos;] =\</div><div class="line">    &apos;sqlite:///&apos; + os.path.join(basedir, &apos;data.sqlite&apos;)</div><div class="line">app.config[&apos;SQLALCHEMY_COMMIT_ON_TEARDOWN&apos;] = True</div><div class="line"># 邮箱提供商服务器，这里是QQ邮箱</div><div class="line">app.config[&apos;MAIL_SERVER&apos;] = &apos;smtp.qq.com&apos;</div><div class="line"># 邮箱服务器端口(QQ邮箱的是465)</div><div class="line">app.config[&apos;MAIL_PORT&apos;] = 465</div><div class="line"># 邮箱通讯协议，注意这里是SSL(选错了邮件发不出的)</div><div class="line">app.config[&apos;MAIL_USE_SSL&apos;] = True</div><div class="line"># 发件邮箱</div><div class="line">app.config[&apos;MAIL_USERNAME&apos;] = &apos;694244330@qq.com&apos;</div><div class="line"># 发件密码</div><div class="line">app.config[&apos;MAIL_PASSWORD&apos;] = &apos;tdjzzgfdiwgobehh&apos;</div><div class="line"># 拼接邮件的主题用，不是必选配置</div><div class="line">app.config[&apos;FLASKY_MAIL_SUBJECT_PREFIX&apos;] = &apos;[Flasky]&apos;</div><div class="line"># 发件邮箱和Mail_username的邮箱要一样</div><div class="line">app.config[&apos;FLASKY_MAIL_SENDER&apos;] = &apos;Flasky Admin &lt;694244330@qq.com&gt;&apos;</div><div class="line"># 收件邮箱</div><div class="line">app.config[&apos;FLASKY_ADMIN&apos;] = &apos;hsw_v5@163.com&apos;</div><div class="line"></div><div class="line">mail = Mail(app)</div></pre></td></tr></table></figure>
<p><strong>注意:</strong>上述配置项一个也不要少</p>
<h2 id="发邮件方法"><a href="#发邮件方法" class="headerlink" title="发邮件方法"></a>发邮件方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">def send_async_email(app, msg):</div><div class="line">    with app.app_context():</div><div class="line">        mail.send(msg)</div><div class="line"></div><div class="line"></div><div class="line">def send_email(to, subject, template, **kwargs):</div><div class="line">    msg = Message(app.config[&apos;FLASKY_MAIL_SUBJECT_PREFIX&apos;] + &apos; &apos; + subject,</div><div class="line">                  sender=app.config[&apos;FLASKY_MAIL_SENDER&apos;], recipients=[to])</div><div class="line">    msg.body = render_template(template + &apos;.txt&apos;, **kwargs)</div><div class="line">    msg.html = render_template(template + &apos;.html&apos;, **kwargs)</div><div class="line">    thr = Thread(target=send_async_email, args=[app, msg])</div><div class="line">    thr.start()</div><div class="line">    return thr</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/12/2016-12-12-SparkRdd/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Hushiwei">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/wei.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Time渐行渐远">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/12/2016-12-12-SparkRdd/" itemprop="url">
                  RDD究竟是什么
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-12T14:00:00+08:00">
                2016-12-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/spark/" itemprop="url" rel="index">
                    <span itemprop="name">spark</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/12/12/2016-12-12-SparkRdd/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/12/2016-12-12-SparkRdd/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="看源码部分关于RDD的注释"><a href="#看源码部分关于RDD的注释" class="headerlink" title="看源码部分关于RDD的注释"></a>看源码部分关于RDD的注释</h2><p>在我们学习spark的时候，如果有什么拿不准，其实去找相关的源码，往往那部分源码都有比较详细的注释。想想，那可是作者的一手解释呢?比起在网上找博客要更合适一些呢。</p>
<ul>
<li>抽象类RDD的注释</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">A Resilient Distributed Dataset (RDD), the basic abstraction in Spark. bke an immutable,</div><div class="line">partitioned collection of elements that can be operated on in parallel. This class contains the</div><div class="line">basic operations available on all RDDs, such as `map`, `filter`, and `persist`. In addition,</div><div class="line">[[org.apache.spark.rdd.PairRDDFunctions]] contains operations available only on RDDs of key-value</div><div class="line">pairs, such as `groupByKey` and `join`;</div><div class="line">[[org.apache.spark.rdd.DoubleRDDFunctions]] contains operations available only on RDDs of</div><div class="line">Doubles; and</div><div class="line">[[org.apache.spark.rdd.SequenceFileRDDFunctions]] contains operations available on RDDs that</div><div class="line">can be saved as SequenceFiles.</div><div class="line">All operations are automatically available on any RDD of the right type (e.g. RDD[(Int, Int)]</div><div class="line">through implicit.</div><div class="line"></div><div class="line">Internally, each RDD is characterized by five main properties:</div><div class="line"></div><div class="line"> - A list of partitions</div><div class="line"> - A function for computing each split</div><div class="line"> - A list of dependencies on other RDDs</div><div class="line"> - Optionally, a Partitioner for key-value RDDs (e.g. to say that the RDD is hash-partitioned)</div><div class="line"> - Optionally, a list of preferred locations to compute each split on (e.g. block locations for</div><div class="line">   an HDFS file)</div><div class="line"></div><div class="line">All of the scheduling and execution in Spark is done based on these methods, allowing each RDD</div><div class="line">to implement its own way of computing itself. Indeed, users can implement custom RDDs (e.g. for</div><div class="line">reading data from a new storage system) by overriding these functions. Please refer to the</div><div class="line">[[http://www.cs.berkeley.edu/~matei/papers/2012/nsdi_spark.pdf Spark paper]] for more details</div><div class="line">on RDD internals.</div></pre></td></tr></table></figure>
<ul>
<li>我简单做个整理总结</li>
</ul>
<p>1.RDD是分布式弹性数据集，是Spark中抽象出的最基本概念。它是不可变，并且一组分区中的元素可以并行处理的数据集。Spark中创建了一些算子来对RDD进行处理。比如:<br><code>map</code>,<code>filter</code>,<code>persist</code>等算子。<br>2.另外在<code>[[org.apache.spark.rdd.PairRDDFunctions]]</code>这个类中，还包含了一些操作key-value类型的RDD。比如:<code>groupByKey</code>,<code>join</code>等算子<br>3.还有其他的类处理对应的一些RDD中包含的数据类型。比如double，sequence等<br>4.所有对RDD的操作都是可用的。主要是借助于scala的隐式转换特性。这样是操作单一元素的RDD还是操作pair类型的RDD，对于RDD而言就隐藏了。</p>
<ul>
<li>RDD的5个特性<ul>
<li>一系列的分区(partition),即数据集的基本组成单位</li>
<li>一个计算每个分片的函数</li>
<li>与父RDD的一系列依赖。这个也就是spark中的血统(lineage)<br>+</li>
</ul>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/11/2016-12-11-LinuxMem/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Hushiwei">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/wei.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Time渐行渐远">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/11/2016-12-11-LinuxMem/" itemprop="url">
                  Linux进程分析之内存
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-11T20:32:00+08:00">
                2016-12-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/12/11/2016-12-11-LinuxMem/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/11/2016-12-11-LinuxMem/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="free命令解析"><a href="#free命令解析" class="headerlink" title="free命令解析"></a>free命令解析</h2><blockquote>
<p>free命令可以用来了解当前操作系统整体可用内存的使用情况</p>
</blockquote>
<h3 id="详解"><a href="#详解" class="headerlink" title="详解"></a>详解</h3><ul>
<li>看看free支持的参数</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">hushiwei@hsw:~$ free --help</div><div class="line"></div><div class="line">Usage:</div><div class="line"> free [options]</div><div class="line"></div><div class="line">Options:</div><div class="line"> -b, --bytes         show output in bytes</div><div class="line">     --kilo          show output in kilobytes</div><div class="line">     --mega          show output in megabytes</div><div class="line">     --giga          show output in gigabytes</div><div class="line">     --tera          show output in terabytes</div><div class="line">     --peta          show output in petabytes</div><div class="line"> -k, --kibi          show output in kibibytes</div><div class="line"> -m, --mebi          show output in mebibytes</div><div class="line"> -g, --gibi          show output in gibibytes</div><div class="line">     --tebi          show output in tebibytes</div><div class="line">     --pebi          show output in pebibytes</div><div class="line"> -h, --human         show human-readable output</div><div class="line">     --si            use powers of 1000 not 1024</div><div class="line"> -l, --lohi          show detailed low and high memory statistics</div><div class="line"> -t, --total         show total for RAM + swap</div><div class="line"> -s N, --seconds N   repeat printing every N seconds</div><div class="line"> -c N, --count N     repeat printing N times, then exit</div><div class="line"> -w, --wide          wide output</div><div class="line"></div><div class="line">     --help     display this help and exit</div><div class="line"> -V, --version  output version information and exit</div></pre></td></tr></table></figure>
<ul>
<li>以人类可看的方式输出</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">hushiwei@hsw:~$ free -h</div><div class="line">              total        used        free      shared  buff/cache   available</div><div class="line">Mem:           7.7G        4.4G        240M        970M        3.0G        2.1G</div><div class="line">Swap:            0B          0B          0B</div></pre></td></tr></table></figure>
<p>我用的是Deepin系统，free命令出来的比一般的ubuntu或者linux命令出来的要少一行。</p>
<p>为了详细的说明，我换一台服务器<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[devel@xxx ~]$ free -h</div><div class="line">             total       used       free     shared    buffers     cached</div><div class="line">Mem:           24G        20G       3.6G        18M       358M        13G</div><div class="line">-/+ buffers/cache:       6.9G        17G</div><div class="line">Swap:         4.0G         0B       4.0G</div></pre></td></tr></table></figure></p>
<ul>
<li>简单说明：<ul>
<li>total:24G 即为总的物理内存大小</li>
<li>used:20G 为当前被系统调度的内存大小</li>
<li>free:3.6G 当前未被系统调度的内存大小</li>
</ul>
</li>
</ul>
<p><strong>注意:</strong> 这里的用词是被系统调度，而不是被系统进程物理占用的内存大小</p>
<p><strong>如何理解:</strong></p>
<ul>
<li>used只是被系统调度的内存，系统可以从used里面划分出有效的内存来调度给新进程使用</li>
<li>只有在可调度内存不够的情况下，才会从free中挪用新内存进行调度。</li>
</ul>
<h3 id="used内存会被系统用来做哪些调度"><a href="#used内存会被系统用来做哪些调度" class="headerlink" title="used内存会被系统用来做哪些调度"></a>used内存会被系统用来做哪些调度</h3><ul>
<li>1.实实在在被进程占用。比如进程申请的栈内存，被分配并被使用的堆内存。在进程存活并未主动释放它的内存情况下，这块内存是无法被系统调度给其他进程使用的。即第三行used=6.9G部分</li>
<li>2.用于<strong>写buffers</strong>,即上面buffers:358M.对于文件写操作需要经过写buffer的过程再落到磁盘上，而buffer这块内存是可以被系统回收并反复被调度的内存。</li>
<li>3.用于<strong>读cached</strong>,即上面的cached:13G.系统会将一大部分内存用于cache,比如用于文件预读等，与buffer相同，这部分内存可以被系统重复调度给信息的进程</li>
</ul>
<p><strong>总结:</strong></p>
<ul>
<li>因此，一个系统<code>**被调度内存大小**=buffers(358M)+cached(13G)+第三行的used(6.9G)=第二行的used(20G)</code></li>
<li><code>**可用于新进程的内存大小**=free(3.6G)+buffers(358M)+cached(13G)=第三行的free(17G)</code></li>
<li>所以，这里第三行表示了当前物理内存被系统占用的内存(used)，以及可以被调度的内存大小(free)</li>
<li>而这里free+used即为total的物理内存大小，也就是机器的所有内存大小。</li>
<li>所以，在日常工作中，可以通过第三行的信息快速获取机器物理内存被实际占用情况。(Deepin系统居然没有这一行…什么原因)</li>
<li>理解了之后,这里终于知道这个<code>-/+ buffers/cache:</code>是什么意思了.实际占用内存也就是已被系统调度内存<strong>减去</strong>buffers和cached内存.</li>
<li>那么实际可用内存也就是系统未被调度内存<strong>加上</strong>buffers和cached内存了</li>
<li>最后，知道每个部分的意思后，就算没有第三行，自己也可以轻易的看出来系统内存实际使用情况</li>
</ul>
<h3 id="相关命令"><a href="#相关命令" class="headerlink" title="相关命令"></a>相关命令</h3><ul>
<li>vmstat</li>
</ul>
<p>free,buffer,cached的值，也可以通过vmstat命令来动态获取它的变化值，比如每隔一秒采集一次，总共采集10次memory的变化；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">hushiwei@hsw:~$ vmstat 1 10</div><div class="line">procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----</div><div class="line"> r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st</div><div class="line"> 0  0      0 420908  95636 3952264    0    0   309    89  420 3104 10  3 83  5  0</div><div class="line"> 0  0      0 438580  95636 3932768    0    0     0   360 1548 12740  8  3 88  0  0</div><div class="line"> 0  0      0 438944  95636 3932684    0    0     0     0  788 7131  2  2 96  0  0</div><div class="line"> 1  0      0 439020  95636 3932684    0    0     0     0  817 11039  3  2 95  0  0</div><div class="line"> 2  0      0 423376  95636 3950340    0    0     0     0 1092 8635  7  5 88  0  0</div><div class="line"> 0  0      0 421692  95644 3951528    0    0     0   236 1231 12386 10  3 84  3  0</div><div class="line"> 1  0      0 439968  95644 3932768    0    0     0   360  881 7472  3  2 95  0  0</div><div class="line"> 1  0      0 439800  95644 3932680    0    0     0     0 3319 22657 15  3 81  0  0</div><div class="line"> 0  0      0 439692  95644 3932680    0    0     0     0  737 7149  3  1 96  0  0</div><div class="line"> 2  0      0 422388  95644 3950288    0    0     0     0  916 12164  7  2 91  0  0</div></pre></td></tr></table></figure></p>
<ul>
<li>watch</li>
</ul>
<p>在linux中可以通过watch命令，实时监控每一条命令执行的结果动态变化。</p>
<ul>
<li>watch命令可以实时全屏监控当前命令执行的动态变化结果</li>
<li>watch命令的常用参数有:<ul>
<li>-n:时隔多少秒刷新(默认每隔2秒刷一次结果)</li>
<li>-d:高亮显示动态变化</li>
<li>-t:关闭命令顶部的时间间隔，命令显示</li>
</ul>
</li>
</ul>
<p>example:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># 每隔3秒查看当前系统时间</div><div class="line">watch -n 3 date</div><div class="line"># -d 参数可以高亮显示执行结果的变化</div><div class="line">watch -n 3 -d date</div></pre></td></tr></table></figure></p>
<p>因此，<strong>watch与free命令配合</strong>，也可以获取到动态的内存变化值。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">watch -n 1 -d free</div></pre></td></tr></table></figure></p>
<h2 id="top命令解析"><a href="#top命令解析" class="headerlink" title="top命令解析"></a>top命令解析</h2><blockquote>
<p>top不仅仅用于内存分析，还用于进程分析。先说关于内存部分</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">top - 10:28:54 up 19 days, 20:48,  1 user,  load average: 0.00, 0.00, 0.00</div><div class="line">Tasks: 362 total,   1 running, 361 sleeping,   0 stopped,   0 zombie</div><div class="line">Cpu(s):  0.0%us,  0.0%sy,  0.0%ni, 99.9%id,  0.0%wa,  0.0%hi,  0.0%si,  0.0%st</div><div class="line">Mem:  25402148k total, 22153960k used,  3248188k free,   367512k buffers</div><div class="line">Swap:  4194300k total,        0k used,  4194300k free, 14689300k cached</div><div class="line"></div><div class="line">   PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND</div><div class="line"> 27234 kafka     20   0 9023m 596m  18m S  1.3  2.4 265:13.15 java</div><div class="line">  1344 root       1 -19  510m 284m 1032 S  0.3  1.1  75:39.37 mfsmount</div><div class="line"> 23913 hdfs      20   0 2932m 645m  24m S  0.3  2.6  81:37.27 java</div><div class="line"> 29664 yarn      20   0 2990m 359m  25m S  0.3  1.4  79:56.77 java</div><div class="line"> 36226 hive      20   0 9349m 744m  25m S  0.3  3.0 112:08.36 java</div><div class="line">     1 root      20   0 19356 1540 1228 S  0.0  0.0   0:02.15 init</div><div class="line">     2 root      20   0     0    0    0 S  0.0  0.0   0:00.02 kthreadd</div><div class="line">     3 root      RT   0     0    0    0 S  0.0  0.0   0:01.00 migration/0</div><div class="line">     4 root      20   0     0    0    0 S  0.0  0.0   0:03.30 ksoftirqd/0</div><div class="line">     5 root      RT   0     0    0    0 S  0.0  0.0   0:00.00 stopper/0</div><div class="line">     6 root      RT   0     0    0    0 S  0.0  0.0   0:01.80 watchdog/0</div><div class="line">     7 root      RT   0     0    0    0 S  0.0  0.0   0:01.35 migration/1</div><div class="line">     8 root      RT   0     0    0    0 S  0.0  0.0   0:00.00 stopper/1</div><div class="line">     9 root      20   0     0    0    0 S  0.0  0.0   0:04.01 ksoftirqd/1</div><div class="line">    10 root      RT   0     0    0    0 S  0.0  0.0   0:01.56 watchdog/1</div><div class="line">    11 root      RT   0     0    0    0 S  0.0  0.0   0:01.00 migration/2</div><div class="line">    12 root      RT   0     0    0    0 S  0.0  0.0   0:00.00 stopper/2</div><div class="line">    13 root      20   0     0    0    0 S  0.0  0.0   0:03.74 ksoftirqd/2</div><div class="line">    14 root      RT   0     0    0    0 S  0.0  0.0   0:01.62 watchdog/2</div><div class="line">    15 root      RT   0     0    0    0 S  0.0  0.0   0:01.10 migration/3</div><div class="line">    16 root      RT   0     0    0    0 S  0.0  0.0   0:00.00 stopper/3</div></pre></td></tr></table></figure>
<p>其中mem部分的total，used，free，buffers，cached与free命令显示的含义是一致的，他们都反应了整个系统的内存消耗情况；</p>
<p>未完待续。。。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/11/2016-12-11-DeepinSoft/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Hushiwei">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/wei.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Time渐行渐远">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/11/2016-12-11-DeepinSoft/" itemprop="url">
                  配置Ubuntu/Deepin下要安装的常用软件
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-11T14:00:00+08:00">
                2016-12-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ubuntu/" itemprop="url" rel="index">
                    <span itemprop="name">ubuntu</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/12/11/2016-12-11-DeepinSoft/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/11/2016-12-11-DeepinSoft/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="给系统更新"><a href="#给系统更新" class="headerlink" title="给系统更新"></a>给系统更新</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get update</div></pre></td></tr></table></figure>
<h2 id="安装sublime3"><a href="#安装sublime3" class="headerlink" title="安装sublime3"></a>安装sublime3</h2><ul>
<li>1.在商店里下载sublime3后</li>
<li>2.用第一个这个就可以注册成功</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">Ryan Clark</div><div class="line">Single User License</div><div class="line">EA7E-812479</div><div class="line">2158A7DE B690A7A3 8EC04710 006A5EEB</div><div class="line">34E77CA3 9C82C81F 0DB6371B 79704E6F</div><div class="line">93F36655 B031503A 03257CCC 01B20F60</div><div class="line">D304FA8D B1B4F0AF 8A76C7BA 0FA94D55</div><div class="line">56D46BCE 5237A341 CD837F30 4D60772D</div><div class="line">349B1179 A996F826 90CDB73C 24D41245</div><div class="line">FD032C30 AD5E7241 4EAA66ED 167D91FB</div><div class="line">55896B16 EA125C81 F550AF6B A6820916</div><div class="line"></div><div class="line">Michael Barnes</div><div class="line">Single User License</div><div class="line">EA7E-821385</div><div class="line">8A353C41 872A0D5C DF9B2950 AFF6F667</div><div class="line">C458EA6D 8EA3C286 98D1D650 131A97AB</div><div class="line">AA919AEC EF20E143 B361B1E7 4C8B7F04</div><div class="line">B085E65E 2F5F5360 8489D422 FB8FC1AA</div><div class="line">93F6323C FD7F7544 3F39C318 D95E6480</div><div class="line">FCCC7561 8A4A1741 68FA4223 ADCEDE07</div><div class="line">200C25BE DBBC4855 C4CFB774 C5EC138C</div><div class="line">0FEC1CEF D9DCECEC D3A5DAD1 01316C36</div></pre></td></tr></table></figure>
<ul>
<li>3.安装插件包管理</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">import urllib.request,os; pf = &apos;Package Control.sublime-package&apos;; ipp = sublime.installed_packages_path(); urllib.request.install_opener( urllib.request.build_opener( urllib.request.ProxyHandler()) ); open(os.path.join(ipp, pf), &apos;wb&apos;).write(urllib.request.urlopen( &apos;http://sublime.wbond.net/&apos; + pf.replace(&apos; &apos;,&apos;%20&apos;)).read())</div></pre></td></tr></table></figure>
<h2 id="安装java-scala-mvn-intellij-idea"><a href="#安装java-scala-mvn-intellij-idea" class="headerlink" title="安装java,scala,mvn,intellij idea"></a>安装java,scala,mvn,intellij idea</h2><ul>
<li>1.解压tar包</li>
<li>2.设置环境变量</li>
<li>3.加载环境变量以生效</li>
</ul>
<h2 id="安装Mysql"><a href="#安装Mysql" class="headerlink" title="安装Mysql"></a>安装Mysql</h2><p>ubuntu上安装MySQL非常简单只需要几条命令就可以完成。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">　　1. sudo apt-get install mysql-server</div><div class="line"></div><div class="line">　　2. apt-get isntall mysql-client</div><div class="line"></div><div class="line">　　3.  sudo apt-get install libmysqlclient-dev</div></pre></td></tr></table></figure></p>
<p>安装过程中会提示设置密码什么的，注意设置了不要忘了，安装完成之后可以使用如下命令来检查是否安装成功：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">　　sudo netstat -tap | grep mysql</div></pre></td></tr></table></figure></p>
<p>通过上述命令检查之后，如果看到有mysql 的socket处于 listen 状态则表示安装成功。</p>
<p>登陆mysql数据库可以通过如下命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">　　mysql -u root -p</div><div class="line"></div><div class="line">　　-u 表示选择登陆的用户名， -p 表示登陆的用户密码，上面命令输入之后会提示输入密码，此时输入密码就可以登录到mysql。</div></pre></td></tr></table></figure></p>
<h2 id="安装-python-环境"><a href="#安装-python-环境" class="headerlink" title="安装 python 环境"></a>安装 python 环境</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install python-pip python-dev</div><div class="line">sudo pip install --upgrade pip</div></pre></td></tr></table></figure>
<p>pip安装常用模块<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sudo pip install django</div><div class="line">sudo pip install MySQL-python</div><div class="line">sudo pip install beautifulsoup4</div></pre></td></tr></table></figure></p>
<h2 id="安装git"><a href="#安装git" class="headerlink" title="安装git"></a>安装git</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install git</div></pre></td></tr></table></figure>
<p>git的执行文件在/usr/bin/git</p>
<h2 id="安装nodejs及npm"><a href="#安装nodejs及npm" class="headerlink" title="安装nodejs及npm"></a>安装nodejs及npm</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">sudo add-apt-repository ppa:chris-lea/node.js</div><div class="line"></div><div class="line">sudo apt-get update</div><div class="line"></div><div class="line">sudo apt-get install python-software-properties python g++ make nodejs npm</div></pre></td></tr></table></figure>
<h2 id="安装jekyll步骤"><a href="#安装jekyll步骤" class="headerlink" title="安装jekyll步骤"></a>安装jekyll步骤</h2><blockquote>
<p>安装一个本地的jekyll环境，方便写博客的时候调试预览效果</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install ruby</div><div class="line">sudo apt-get install ruby-dev(用这个命令，不然后面装jekyll会出现缺文件的错误)</div><div class="line">ruby -v （检查一下版本）</div><div class="line">gem -v （检查一下版本）</div><div class="line">sudo apt-get install nodejs （把nodejs也装上）</div><div class="line">sudo gem install jekyll （最后可以安装jekyll了）</div></pre></td></tr></table></figure>
<p><strong>注意：</strong> 最后安装jekyll的时候，如果报了缺少什么的错误。根据提示的错误，下载缺少的文件即可。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/11/2016-12-11-UbuntuSocks/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Hushiwei">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/wei.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Time渐行渐远">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/11/2016-12-11-UbuntuSocks/" itemprop="url">
                  Ubuntu/Deepin下用Shadowsocks实现翻墙上网
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-11T10:01:00+08:00">
                2016-12-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/shadowsocks/" itemprop="url" rel="index">
                    <span itemprop="name">shadowsocks</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/12/11/2016-12-11-UbuntuSocks/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/11/2016-12-11-UbuntuSocks/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="下载安装小飞机"><a href="#下载安装小飞机" class="headerlink" title="下载安装小飞机"></a>下载安装小飞机</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">sudo add-apt-repository ppa:hzwhuang/ss-qt5</div><div class="line"></div><div class="line">sudo apt-get update</div><div class="line"></div><div class="line">sudo apt-get install shadowsocks-qt5</div></pre></td></tr></table></figure>
<p><img src="/images/pics/shadowsocksSoft.png" alt="小飞机"></p>
<h2 id="配置代理"><a href="#配置代理" class="headerlink" title="配置代理"></a>配置代理</h2><ul>
<li>配置账号</li>
</ul>
<p>如图所示</p>
<p>点击连接，配置自己的代理服务器的IP地址，密码，端口等。仿照我填的那样填写。</p>
<p><img src="/images/pics/SocksConf.png" alt="socksConf"></p>
<p>然后，点击测试延迟，看看有没有出现延迟，出现了，那么就是连接上了。</p>
<p><img src="/images/pics/SocksConf2.png" alt="socksConf2"></p>
<h2 id="本地配置"><a href="#本地配置" class="headerlink" title="本地配置"></a>本地配置</h2><p>代理那里，方法请选择<strong>手动</strong>，Socks主机位置填写的是你Shadowsocks里的本地地址IP，我的都是<strong>127.0.0.1</strong>，端口也是一样。<br>然后，点击应用到整个系统。</p>
<ul>
<li>Ubuntu这里是这样的</li>
</ul>
<p><img src="/images/pics/ubuntuSocks.png" alt="ubuntuSocks"></p>
<ul>
<li>Deepin是这样的</li>
</ul>
<p><img src="/images/pics/deepinSocks.png" alt="deepinSocks"></p>
<h2 id="浏览器插件"><a href="#浏览器插件" class="headerlink" title="浏览器插件"></a>浏览器插件</h2><p>此时你并不能科学上网，因为这个方式并不是所谓”全局代理”，所以你需要配置一下你的浏览器。我所使用的是Chrome，然后安装SwitchySharp插件，市场访问不了可以搜一下墙内的资源，跨平台所以win的也能用，拖放进去而已。<br>记住要打开Chrome的扩展界面，才可以把离线插件拖进行进行安装。为了方便大家安装，这里我提供下载链接。链接失效请联系我.<br><a href="https://pan.baidu.com/s/1i5Pr3TF" target="_blank" rel="external">下载地址</a>  密码: fjfq</p>
<h2 id="Chrome代理设置"><a href="#Chrome代理设置" class="headerlink" title="Chrome代理设置"></a>Chrome代理设置</h2><ol>
<li>首先，我们确保已在Chrome浏览器中安装好了Proxy SwitchySharp扩展.</li>
</ol>
<p><img src="/images/pics/proxy1.png" alt="proxy1"></p>
<p>进入选项页后，我们在情景模式中，新建一个模式。<br>名称随便填写<br>然后按照我的截图那样填写，千万不要填错了。<br>shadowsocks使用的就是SOCKS v5的协议，ip和端口号要跟系统设置的一致。<br>然后点击保存。</p>
<p><img src="/images/pics/proxy2.png" alt="proxy2"></p>
<p>2.设置切换规则</p>
<p>然后点击“切换规则”，分别新建两条规则。</p>
<ul>
<li><p>本地规则，选择正则表达式<br>目的是让浏览器可以访问局域网等此类网址时候，不适用任何代理，即可直接访问。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">192\.168\.|localhost</div></pre></td></tr></table></figure>
</li>
<li><p>国外规则，选择正则表达式<br>让我们访问国外的网址的时候，就可以通过代理进行翻墙访问了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(fbcdn|akamaihd|pixnet)\.net|wretch\.cc|t\.co|goo\.gl|(google(usercontent|apis)*|chrome|staticflickr|imdb|ytimg|gstatic|html5rocks|amazonaws|github|tumblr|addthis|wordpress|blogger|(blog|app)spot|friendfeed|twitter|facebook|youtube|dropbox|feedburner|googleapis|android)\.com</div></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="/images/pics/proxy3.png" alt="proxy3"></p>
<h2 id="自动切换代理"><a href="#自动切换代理" class="headerlink" title="自动切换代理"></a>自动切换代理</h2><p>最后保存之后，再点击浏览器上面的Proxy SwitchySharp扩展图标，点击勾选其中的<strong>自动却换模式</strong>,即可在浏览网页<br>时，让扩展自动根据之前的规则来判断使用何种代理了，而不需要我们自己受到切换了了。</p>
<p>最后，根据自己的情况设置是否开机自启动。</p>
<h2 id="完成"><a href="#完成" class="headerlink" title="完成"></a>完成</h2><p>可以自由翻墙了。。。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/09/2016-11-24-BeautifulSoup/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Hushiwei">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/wei.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Time渐行渐远">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/09/2016-11-24-BeautifulSoup/" itemprop="url">
                  python beautifulsoup使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-09T18:24:00+08:00">
                2016-12-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/12/09/2016-11-24-BeautifulSoup/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/09/2016-11-24-BeautifulSoup/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>操作文档树最简单的方法就是告诉它你想获取的tag的name.如果想获取 <head> 标签,只要用 soup.head :</head></p>
<p>tag的 .contents 属性可以将tag的子节点以列表的方式输出:</p>
<p>通过tag的 .children 生成器,可以对tag的子节点进行循环:</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/07/2016-12-7-Queue/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Hushiwei">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/wei.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Time渐行渐远">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/07/2016-12-7-Queue/" itemprop="url">
                  Java数据结构之队列
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-07T10:01:00+08:00">
                2016-12-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/datastructure/" itemprop="url" rel="index">
                    <span itemprop="name">datastructure</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/12/07/2016-12-7-Queue/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/07/2016-12-7-Queue/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="什么是队列"><a href="#什么是队列" class="headerlink" title="什么是队列"></a>什么是队列</h2><ul>
<li>队列是一种受限的线性表,其限制是仅允许在队的一端进行插入,而在队的另一端进行删除.</li>
<li>在队列中把插入数据元素的一端称为<strong>队尾(rear)</strong>.</li>
<li>删除数据元素的一端称为<strong>队首(front)</strong>.</li>
<li>向队尾插入元素称为<strong>进队或入队</strong>.新元素入队后成为新的队尾元素.</li>
<li>从队列中删除元素称为<strong>离队或出队</strong>.元素出队后,其后续元素成为新的队首元素</li>
<li>因此在队列中,先入队的元素,肯定是先出队.所以称队列为<strong>先进先出表(FIFO)</strong>.</li>
</ul>
<p>队列结构与日常生活中排队等候服务的模型是一致的,最早进入队列的人,最早得到服务从队首离开;最后到来的人只能排在队列的最后,最后得到服务并最后离开.</p>
<h2 id="队列的常用方法"><a href="#队列的常用方法" class="headerlink" title="队列的常用方法"></a>队列的常用方法</h2><p>队列结构一般都满足以下几个方法:</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>功能描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>getSize()</td>
<td>返回队列的大小,即队列中元素的个数</td>
</tr>
<tr>
<td>isEmpty()</td>
<td>判断队列是为空</td>
</tr>
<tr>
<td>enqueue(e)</td>
<td>将元素e入队</td>
</tr>
<tr>
<td>dequeue</td>
<td>删除队尾元素</td>
</tr>
<tr>
<td>peek()</td>
<td>获取队首元素,但不出队</td>
</tr>
</tbody>
</table>
<p>接口代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Created by HuShiwei on 2016/10/18 0018.</div><div class="line"> * FIFO先进先出</div><div class="line"> */</div><div class="line">public interface Queue &#123;</div><div class="line">    public int getSize();//返回队列的大小</div><div class="line"></div><div class="line">    public boolean isEmpty();//判断队列是否为空</div><div class="line"></div><div class="line">    public void enqueue(Object e);//数据元素e入队</div><div class="line"></div><div class="line">    public Object dequeue();//队首元素出队</div><div class="line"></div><div class="line">    public Object peek();//取队首元素</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="队列的线性表实现"><a href="#队列的线性表实现" class="headerlink" title="队列的线性表实现"></a>队列的线性表实现</h2><h3 id="实现分析"><a href="#实现分析" class="headerlink" title="实现分析"></a>实现分析</h3><blockquote>
<p>队列的线性表实现:底层是用的数组存储队列元素.</p>
</blockquote>
<p><img src="/images/pics/queueArray.png" alt="queueArray"></p>
<ul>
<li>如何判断队列是否满队列还是空队列<ul>
<li>设计了一个循环数组</li>
<li>设计一个队首指针front,和一个队尾指针rear</li>
<li>front指向队列的首元素,rear指向队尾的最后一个元素+1的位置</li>
</ul>
</li>
<li>如何判断队列是空队列还是满队列?<ul>
<li>当是空队列的时候,front=rear,两个指针都指向同一个位置</li>
<li>当是满队列的时候,因为是循环数组,所以front=rear.这样我们就没办法区分是空队列还是满队列了.</li>
</ul>
</li>
<li>如何解决这个问题呢?<ul>
<li>把数组的最后一个位置空出来,浪费最后的存储空间.</li>
<li>这样,判断是满队列的时候,就可以根据(rear+1)%capacity=front</li>
</ul>
</li>
<li>注意点<ul>
<li>队尾指针rear指向队尾元素+1的位置.这样在队尾入队的时候就可以指针赋值了</li>
</ul>
</li>
</ul>
<h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><p><strong>注意: 在实现队列的时候，一定要记住</strong></p>
<ul>
<li>队列的结构特性，FIFO</li>
<li>如何通过指针来操作</li>
<li>理解了这些,自己就可以很轻松的实现队列了</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 队列的顺序存储实现</div><div class="line"> */</div><div class="line">public class QueueArray implements Queue &#123;</div><div class="line">    private static final int CAP = 7;//队列默认大小</div><div class="line">    private Object[] elements;//数据元素数组</div><div class="line">    private int capacity;//数组的大小</div><div class="line">    private int front;//队首指针</div><div class="line">    private int rear;//队尾指针</div><div class="line"></div><div class="line">    public QueueArray() &#123;</div><div class="line">        this(CAP);</div><div class="line">    &#125;</div><div class="line">//    初始化队列</div><div class="line">    public QueueArray(int cap)&#123;</div><div class="line">        capacity = cap + 1;</div><div class="line">        elements = new Object[capacity];</div><div class="line">        front = rear = 0;</div><div class="line">    &#125;</div><div class="line">//    返回队列的大小</div><div class="line">    @Override</div><div class="line">    public int getSize() &#123;</div><div class="line">        return (rear-front+capacity)%capacity;</div><div class="line">    &#125;</div><div class="line">//    判断队列是否为空</div><div class="line">    @Override</div><div class="line">    public boolean isEmpty() &#123;</div><div class="line">        return front==rear;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">//    数据元素e入队</div><div class="line">    @Override</div><div class="line">    public void enqueue(Object e) &#123;</div><div class="line">        if (getSize()==capacity-1) &#123;</div><div class="line">            expandSpace();</div><div class="line">        &#125;</div><div class="line">        elements[rear] = e;</div><div class="line">        rear = (rear + 1) % capacity;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">//    扩充队列大小</div><div class="line">    private void expandSpace() &#123;</div><div class="line">        Object[] objects = new Object[elements.length * 2];</div><div class="line">        int i=front;</div><div class="line">        int j = 0;</div><div class="line">        while (i != rear) &#123;</div><div class="line">            objects[j++] = elements[i];</div><div class="line">            i = (i + 1) % capacity;</div><div class="line">        &#125;</div><div class="line">        elements = objects;</div><div class="line">        capacity = elements.length;</div><div class="line">//        设置新的队首队尾指针</div><div class="line">        front = 0;</div><div class="line">        rear = j;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">//    队首元素出队</div><div class="line">    @Override</div><div class="line">    public Object dequeue() &#123;</div><div class="line">        if (isEmpty()) &#123;</div><div class="line">            try &#123;</div><div class="line">                throw new Exception(&quot;错误: 队列空了...&quot;);</div><div class="line">            &#125; catch (Exception e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        Object element = elements[front];</div><div class="line">        elements[front] = null;</div><div class="line">        front = (front + 1) % capacity;</div><div class="line">        return element;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">//    取队首元素</div><div class="line">    @Override</div><div class="line">    public Object peek() &#123;</div><div class="line">        if (isEmpty()) &#123;</div><div class="line">            try &#123;</div><div class="line">                throw new Exception(&quot;错误: 队列空了...&quot;);</div><div class="line">            &#125; catch (Exception e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        return elements[front];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="队列的链式存储实现"><a href="#队列的链式存储实现" class="headerlink" title="队列的链式存储实现"></a>队列的链式存储实现</h2><p>未完待续….</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/06/2016-12-5-JavaThread/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Hushiwei">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/wei.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Time渐行渐远">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/06/2016-12-5-JavaThread/" itemprop="url">
                  Java多线程总结笔记
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-06T14:22:00+08:00">
                2016-12-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/12/06/2016-12-5-JavaThread/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/06/2016-12-5-JavaThread/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="多线程的概述"><a href="#多线程的概述" class="headerlink" title="多线程的概述"></a>多线程的概述</h2><h3 id="进程和线程"><a href="#进程和线程" class="headerlink" title="进程和线程"></a>进程和线程</h3><blockquote>
<ul>
<li>进程:是一个正在运行的程序,每个进程执行,都有一个执行顺序,该顺序是一个执行路径,或者叫一个控制单元</li>
<li>线程:进程中的一个独立控制单元,线程在控制着进程的执行,一个进程中至少有一个线程(控制单元)</li>
</ul>
</blockquote>
<h2 id="简单实现多线程"><a href="#简单实现多线程" class="headerlink" title="简单实现多线程"></a>简单实现多线程</h2><blockquote>
<p>常用的实现多线程的两种方法,继承Thread类,实现Runnable接口</p>
</blockquote>
<h3 id="继承javalangThread类"><a href="#继承javalangThread类" class="headerlink" title="继承javalangThread类"></a>继承javalangThread类</h3><ul>
<li>步骤：<ul>
<li>1、首先，定义类继承Thread；</li>
<li>2、复写Thread类中的run方法；目的：将自定义代码存储在run方法中，让线程执行</li>
<li>3、调用线程的start方法(该方法有两个作用：启动线程和调用run()方法)</li>
</ul>
</li>
</ul>
<p><strong>代码示例:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">public class BasicThread extends Thread &#123;</div><div class="line">    @Override</div><div class="line">    public void run() &#123;</div><div class="line">        for (int i = 0; i &lt; 10; i++) &#123;</div><div class="line">            System.out.println(&quot;Thread ID: &quot;+i);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public class MainFunction &#123;</div><div class="line">    public static void main(String[] args) &#123;</div><div class="line">        BasicThread basicThread = new BasicThread();</div><div class="line">        basicThread.start();</div><div class="line">        for (int i = 0; i &lt; 10; i++) &#123;</div><div class="line">            System.out.println(&quot;Main Function ID: &quot;+i);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>要点:继承Thread类,重写run方法.</p>
<h3 id="实现javalangRunnable接口"><a href="#实现javalangRunnable接口" class="headerlink" title="实现javalangRunnable接口"></a>实现javalangRunnable接口</h3><ul>
<li>步骤：<ul>
<li>1、定义类实现Runnable接口</li>
<li>2、复写接口中的run方法</li>
<li>3、创建实现Runnable接口对象</li>
<li>4、创建Thread类对象，将实现Runnable接口的对象作为实际参数传递给Thread类的构造函数</li>
<li>5、调用Thread类的start方法，开启接口</li>
</ul>
</li>
</ul>
<p><strong>代码示例:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">public class BasicRunnable implements Runnable &#123;</div><div class="line">    @Override</div><div class="line">    public void run() &#123;</div><div class="line">        for (int i = 0; i &lt; 10; i++) &#123;</div><div class="line">            System.out.println(Thread.currentThread().getName()+&quot; ---&gt; &quot;+i);</div><div class="line">            try &#123;</div><div class="line">                Thread.sleep(1000);</div><div class="line">            &#125; catch (InterruptedException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">public class MainRunnable &#123;</div><div class="line">    public static void main(String[] args) &#123;</div><div class="line">        Thread thread = new Thread(new BasicRunnable());</div><div class="line">        thread.setName(&quot;Child Thread&quot;);</div><div class="line">        thread.start();</div><div class="line">        for (int i = 0; i &lt; 10; i++) &#123;</div><div class="line">            System.out.println(Thread.currentThread()+&quot; ---&gt; &quot;+i);</div><div class="line">            try &#123;</div><div class="line">                Thread.sleep(1000);</div><div class="line">            &#125; catch (InterruptedException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="为什么要重写run方法"><a href="#为什么要重写run方法" class="headerlink" title="为什么要重写run方法"></a>为什么要重写run方法</h3><p>因为Thread类定义了一个用于存储线程要运行的代码的方法,该方法就是run方法.也就是说Thread类中run方法,用于<br>存储线程要运行的代码.主线程中的代码存储于main方法中.</p>
<h2 id="继承Thread类和实现Runnable接口有什么区别？"><a href="#继承Thread类和实现Runnable接口有什么区别？" class="headerlink" title="继承Thread类和实现Runnable接口有什么区别？"></a>继承Thread类和实现Runnable接口有什么区别？</h2><ul>
<li>继承Thread类:线程代码存放在Thread子类的run方法中</li>
<li>实现Runnable接口:线程代码存放在Runnable实现类的run方法中</li>
<li>实现Runnable接口避免了单继承的局限性,在定义线程时建议使用实现方式来完成</li>
</ul>
<h2 id="线程数据共享问题—锁"><a href="#线程数据共享问题—锁" class="headerlink" title="线程数据共享问题—锁"></a>线程数据共享问题—锁</h2><p><strong>问题:</strong> 当多个线程共享同一个数据时,导致共享数据出现错误<br><strong>解决方案:</strong> 当一个线程执行时,其他的线程不能参与执行.<br><strong>锁:</strong> 对象如图锁,持有锁的线程才能在同步中执行,没有锁的线程,即使获取了CPU的执行权,也进不去.</p>
<ul>
<li>同步的前提:<ul>
<li>必须要有两个或两个以上的线程访问共享数据</li>
<li>必须是多个线程使用同一个锁</li>
</ul>
</li>
<li>好处:解决了多线程安全问题</li>
<li>弊端:多个线程都需要判断锁,较为消耗资源</li>
</ul>
<p>伪代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">synchronized(监视器对象)&#123;</div><div class="line">//需要被同步的代码</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="synchronized同步代码块"><a href="#synchronized同步代码块" class="headerlink" title="synchronized同步代码块"></a>synchronized同步代码块</h3><p>虽然Java允许使用任何对象作为监视器对象.但想一下同步的目的:阻止多个线程同时对同一个共享资源并发访问,<br>因此通常使用可能被并发访问的资源作为同步监视器对象.</p>
<p>经典案例:模拟银行取钱操作</p>
<p>账户对象:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">public class Account &#123;</div><div class="line">    private double balance;//账户余额</div><div class="line"></div><div class="line">    public Account(double balance) &#123;</div><div class="line">        this.balance = balance;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 取钱</div><div class="line">     * @param drawBalance</div><div class="line">     * @return</div><div class="line">     */</div><div class="line">    public double drawMoney(double drawBalance) &#123;</div><div class="line">        balance = balance - drawBalance;</div><div class="line">        return balance;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 查询余额</div><div class="line">     * @return</div><div class="line">     */</div><div class="line">    public double getBalance() &#123;</div><div class="line">        return balance;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>取钱线程:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">public class DrawThread extends Thread &#123;</div><div class="line">    private Account account;</div><div class="line">    private double drawBalance;</div><div class="line"></div><div class="line">    public DrawThread(String name, Account account, double drawBalance) &#123;</div><div class="line">        super(name);</div><div class="line">        this.account=account;</div><div class="line">        this.drawBalance=drawBalance;</div><div class="line">    &#125;</div><div class="line">    @Override</div><div class="line">    public void run() &#123;</div><div class="line">        while (true) &#123;</div><div class="line">//            同步代码块,将共享访问的Account对象作为锁</div><div class="line">            synchronized (account) &#123;</div><div class="line">                if (account.getBalance()&lt;drawBalance) &#123;</div><div class="line">                    System.out.println(Thread.currentThread()+&quot; : 余额不足,当前余额: &quot;+account.getBalance());</div><div class="line">                    break;</div><div class="line">                &#125;</div><div class="line">                try &#123;</div><div class="line">                    Thread.sleep(1000);</div><div class="line">                &#125; catch (InterruptedException e) &#123;</div><div class="line">                    e.printStackTrace();</div><div class="line">                &#125;</div><div class="line">                account.drawMoney(drawBalance);</div><div class="line">                System.out.println(Thread.currentThread()+&quot;取钱成功,取走金额: &quot;+drawBalance+&quot; ,当前余额: &quot;+account.getBalance());</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>测试取钱:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">public class DrawTest &#123;</div><div class="line">    public static void main(String[] args) &#123;</div><div class="line">        Account account = new Account(1000);</div><div class="line">        new DrawThread(&quot;A账户: &quot;,account,500).start();</div><div class="line">        new DrawThread(&quot;B账户: &quot;,account,300).start();</div><div class="line">        new DrawThread(&quot;C账户: &quot;,account,100).start();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">结果输出:</div><div class="line">Thread[B账户: ,5,main]取钱成功,取走金额: 300.0 ,当前余额: 700.0</div><div class="line">Thread[B账户: ,5,main]取钱成功,取走金额: 300.0 ,当前余额: 400.0</div><div class="line">Thread[B账户: ,5,main]取钱成功,取走金额: 300.0 ,当前余额: 100.0</div><div class="line">Thread[B账户: ,5,main] : 余额不足,当前余额: 100.0</div><div class="line">Thread[C账户: ,5,main]取钱成功,取走金额: 100.0 ,当前余额: 0.0</div><div class="line">Thread[C账户: ,5,main] : 余额不足,当前余额: 0.0</div><div class="line">Thread[A账户: ,5,main] : 余额不足,当前余额: 0.0</div></pre></td></tr></table></figure>
<h3 id="synchronized同步方法"><a href="#synchronized同步方法" class="headerlink" title="synchronized同步方法"></a>synchronized同步方法</h3><blockquote>
<p>同步方法是使用synchronized关键字来修饰某个方法,则该方法就被称为同步方法.</p>
</blockquote>
<ul>
<li>伪代码:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public synchronized void disPlay()&#123;&#125;</div></pre></td></tr></table></figure>
<ul>
<li>特点:<ul>
<li>1.对于同步方法而言,无需指定同步监视器对象.同步方法的同步监视器对象是this.</li>
<li>2.一个对象的一个同步方法被调用,这个对象的其他同步方法都用不了.</li>
</ul>
</li>
</ul>
<p>代码说明:</p>
<p>业务类:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">public class Working &#123;</div><div class="line">    public synchronized void tom() &#123;</div><div class="line">        System.out.println(&quot;tom in...&quot;+&quot;\n&quot;+&quot;tom say: Hello Jerry &quot;);</div><div class="line">        try &#123;</div><div class="line">            Thread.sleep(3000);</div><div class="line">        &#125; catch (InterruptedException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        System.out.println(&quot;tom out...&quot;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public synchronized void jerry() &#123;</div><div class="line">        System.out.println(&quot;jerry in...&quot;+&quot;\n&quot;+&quot;jerry say: Hello Tom&quot;);</div><div class="line">        System.out.println(&quot;jerry out...&quot;);</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>线程类:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">public class JerryThread extends Thread &#123;</div><div class="line">    private Working working;</div><div class="line"></div><div class="line">    public JerryThread(Working working) &#123;</div><div class="line">        this.working = working;</div><div class="line">    &#125;</div><div class="line">    @Override</div><div class="line">    public void run() &#123;</div><div class="line">        working.jerry();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public class TomThread extends Thread &#123;</div><div class="line">    private Working working;</div><div class="line"></div><div class="line">    public TomThread(Working working) &#123;</div><div class="line">        this.working = working;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void run() &#123;</div><div class="line">        working.tom();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>测试类:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">public class SynFunction &#123;</div><div class="line">    public static void main(String[] args) &#123;</div><div class="line">        Working working = new Working();</div><div class="line">        TomThread tomThread = new TomThread(working);</div><div class="line">        JerryThread jerryThread = new JerryThread(working);</div><div class="line">        tomThread.start();</div><div class="line">        jerryThread.start();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">输出结果:</div><div class="line">jerry in...</div><div class="line">jerry say: Hello Tom</div><div class="line">jerry out...</div><div class="line">tom in...</div><div class="line">tom say: Hello Jerry</div><div class="line">tom out...</div></pre></td></tr></table></figure>
<p>从输出可以印证之前说的同步方法的特点:当一个对象的同步方法被调用,它的其他同步方法都用不了.</p>
<h3 id="死锁"><a href="#死锁" class="headerlink" title="死锁"></a>死锁</h3><p>死锁现象: 当两个线程互相等待对方释放同步监视器时就会发生死锁.Java虚拟机没有检测,也没有采取措施来处理死锁情况,<br>所以多线程应该避免死锁的出现.一旦程序出现死锁,整个程序既不会发生异常,也不会有任何提示.只是所有线程都处于阻塞状态.</p>
<p>一般这种情况发生在:同步中嵌套同步,但锁不同.<br>比如:a线程锁定一个资源,同时想获取b线程的资源.b线程锁定一个资源,同时想获取a线程的资源.</p>
<p>代码示例:</p>
<p>线程1:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">public class Thread1 extends Thread &#123;</div><div class="line">    @Override</div><div class="line">    public void run() &#123;</div><div class="line">        synchronized (Object.class) &#123;</div><div class="line">            System.out.println(Thread.currentThread().getName()+&quot;...外层锁&quot;);</div><div class="line">            try &#123;</div><div class="line">                Thread.sleep(10);</div><div class="line">            &#125; catch (InterruptedException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">            synchronized (String.class) &#123;</div><div class="line">                System.out.println(&quot;haha,锁主了&quot;);</div><div class="line"></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>线程2:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">public class Thread2 extends Thread &#123;</div><div class="line">    @Override</div><div class="line">    public void run() &#123;</div><div class="line">        synchronized (String.class) &#123;</div><div class="line">            System.out.println(Thread.currentThread().getName()+&quot;...外层锁&quot;);</div><div class="line">            try &#123;</div><div class="line">                Thread.sleep(10);</div><div class="line">            &#125; catch (InterruptedException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">            synchronized (Object.class) &#123;</div><div class="line">                System.out.println(&quot;haha,我也锁主了&quot;);</div><div class="line"></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>测试类:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">public class LockFunction &#123;</div><div class="line">    public static void main(String[] args) &#123;</div><div class="line">        Thread1 thread1 = new Thread1();</div><div class="line">        Thread2 thread2 = new Thread2();</div><div class="line">        thread1.start();</div><div class="line">        thread2.start();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">输出:</div><div class="line">Thread-0...外层锁</div><div class="line">Thread-1...外层锁</div></pre></td></tr></table></figure>
<h2 id="线程通信"><a href="#线程通信" class="headerlink" title="线程通信"></a>线程通信</h2><blockquote>
<p>当多个线程访问同一个资源,每个线程的实现功能不一样,而每个线程之间需要协调发展(两种线程交替运行)</p>
</blockquote>
<p>例如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">老师：我们开始上课；</div><div class="line">学生A：老师等一下，我要去厕所；</div><div class="line">老师：OK，你快点，那我wait()了，等你回来notify我一下。</div></pre></td></tr></table></figure>
<p>线程通信的前提:<strong>同步环境</strong></p>
<p>代码说明:<br>加入了存钱的业务,现在分别有两个不同的业务了.</p>
<p>银行类:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">public class Bank &#123;</div><div class="line">    private double money;</div><div class="line">    boolean flag = false;</div><div class="line"></div><div class="line">    public Bank(double money) &#123;</div><div class="line">        this.money = money;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 取钱方法</div><div class="line">     * @param drawMoney</div><div class="line">     * @return</div><div class="line">     */</div><div class="line">    public double drawMoney(double drawMoney) &#123;</div><div class="line">        money = money - drawMoney;</div><div class="line">        return money;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 存钱</div><div class="line">     * @param saveMoney</div><div class="line">     * @return</div><div class="line">     */</div><div class="line">    public double saveMoney(double saveMoney) &#123;</div><div class="line">        money = money + saveMoney;</div><div class="line">        return money;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 查询余额</div><div class="line">     * @return</div><div class="line">     */</div><div class="line">    public double getMoney() &#123;</div><div class="line">        return money;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>存钱类:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">public class SaveThread extends Thread &#123;</div><div class="line">    private Bank bank;</div><div class="line">    private double saveMoney;</div><div class="line"></div><div class="line">    public SaveThread(String threadName, Bank bank, double saveMoney) &#123;</div><div class="line">        super(threadName);</div><div class="line">        this.bank=bank;</div><div class="line">        this.saveMoney = saveMoney;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void run() &#123;</div><div class="line">        while (true) &#123;</div><div class="line">            synchronized (bank) &#123;</div><div class="line">                if (bank.flag) &#123;</div><div class="line">                    try &#123;</div><div class="line">                        bank.wait();</div><div class="line">                    &#125; catch (InterruptedException e) &#123;</div><div class="line">                        e.printStackTrace();</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                bank.saveMoney(saveMoney);</div><div class="line">                System.out.println(Thread.currentThread().getName() + &quot; 存款成功,存款金额: &quot; + saveMoney + &quot;,账户余额:&quot; + bank.getMoney());</div><div class="line">                bank.flag = true;</div><div class="line">                bank.notify();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>取钱类:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">public class DrawThread extends Thread &#123;</div><div class="line">    private Bank bank;</div><div class="line">    private double drawMoney;</div><div class="line"></div><div class="line">    public DrawThread(String threadName, Bank bank, double drawMoney) &#123;</div><div class="line">        super(threadName);</div><div class="line">        this.bank = bank;</div><div class="line">        this.drawMoney = drawMoney;</div><div class="line">    &#125;</div><div class="line">    @Override</div><div class="line">    public void run() &#123;</div><div class="line">        while (true) &#123;</div><div class="line">            synchronized (bank) &#123;</div><div class="line">                if (!bank.flag) &#123;</div><div class="line">                    try &#123;</div><div class="line">                        bank.wait();</div><div class="line">                    &#125; catch (InterruptedException e) &#123;</div><div class="line">                        e.printStackTrace();</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                if (bank.getMoney() &lt; drawMoney) &#123;</div><div class="line">                    System.out.println(&quot;余额不足,当前余额是: &quot; + bank.getMoney());</div><div class="line">                    break;</div><div class="line">                &#125;</div><div class="line">                bank.drawMoney(drawMoney);</div><div class="line">                System.out.println(Thread.currentThread().getName()+&quot; 取款成功,取款金额是: &quot;+drawMoney+&quot;,账户余额: &quot;+bank.getMoney());</div><div class="line">                bank.flag = false;</div><div class="line">                bank.notify();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>测试类:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">public class BankTest &#123;</div><div class="line">    public static void main(String[] args) &#123;</div><div class="line">        Bank bank = new Bank(5000);</div><div class="line">        new DrawThread(&quot;取钱线程&quot;,bank,500).start();</div><div class="line">        new SaveThread(&quot;存钱线程&quot;,bank,200).start();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">输出:</div><div class="line">存钱线程存款成功,存款金额: 200.0,账户余额:5200.0</div><div class="line">取钱线程 取款成功,取款金额是: 500.0,账户余额: 4700.0</div><div class="line">存钱线程存款成功,存款金额: 200.0,账户余额:4900.0</div><div class="line">取钱线程 取款成功,取款金额是: 500.0,账户余额: 4400.0</div><div class="line">存钱线程存款成功,存款金额: 200.0,账户余额:4600.0</div><div class="line">取钱线程 取款成功,取款金额是: 500.0,账户余额: 4100.0</div><div class="line">存钱线程存款成功,存款金额: 200.0,账户余额:4300.0</div><div class="line">取钱线程 取款成功,取款金额是: 500.0,账户余额: 3800.0</div><div class="line">存钱线程存款成功,存款金额: 200.0,账户余额:4000.0</div><div class="line">取钱线程 取款成功,取款金额是: 500.0,账户余额: 3500.0</div><div class="line">存钱线程存款成功,存款金额: 200.0,账户余额:3700.0</div><div class="line">取钱线程 取款成功,取款金额是: 500.0,账户余额: 3200.0</div><div class="line">存钱线程存款成功,存款金额: 200.0,账户余额:3400.0</div><div class="line">取钱线程 取款成功,取款金额是: 500.0,账户余额: 2900.0</div><div class="line">存钱线程存款成功,存款金额: 200.0,账户余额:3100.0</div><div class="line">取钱线程 取款成功,取款金额是: 500.0,账户余额: 2600.0</div><div class="line">存钱线程存款成功,存款金额: 200.0,账户余额:2800.0</div><div class="line">取钱线程 取款成功,取款金额是: 500.0,账户余额: 2300.0</div><div class="line">存钱线程存款成功,存款金额: 200.0,账户余额:2500.0</div><div class="line">取钱线程 取款成功,取款金额是: 500.0,账户余额: 2000.0</div><div class="line">存钱线程存款成功,存款金额: 200.0,账户余额:2200.0</div><div class="line">取钱线程 取款成功,取款金额是: 500.0,账户余额: 1700.0</div><div class="line">存钱线程存款成功,存款金额: 200.0,账户余额:1900.0</div><div class="line">取钱线程 取款成功,取款金额是: 500.0,账户余额: 1400.0</div><div class="line">存钱线程存款成功,存款金额: 200.0,账户余额:1600.0</div><div class="line">取钱线程 取款成功,取款金额是: 500.0,账户余额: 1100.0</div><div class="line">存钱线程存款成功,存款金额: 200.0,账户余额:1300.0</div><div class="line">取钱线程 取款成功,取款金额是: 500.0,账户余额: 800.0</div><div class="line">存钱线程存款成功,存款金额: 200.0,账户余额:1000.0</div><div class="line">取钱线程 取款成功,取款金额是: 500.0,账户余额: 500.0</div><div class="line">存钱线程存款成功,存款金额: 200.0,账户余额:700.0</div><div class="line">取钱线程 取款成功,取款金额是: 500.0,账户余额: 200.0</div><div class="line">存钱线程存款成功,存款金额: 200.0,账户余额:400.0</div><div class="line">余额不足,当前余额是: 400.0</div></pre></td></tr></table></figure>
<h2 id="线程学习的经典案例-生产者消费者案例"><a href="#线程学习的经典案例-生产者消费者案例" class="headerlink" title="线程学习的经典案例-生产者消费者案例"></a>线程学习的经典案例-生产者消费者案例</h2><blockquote>
<p>大多数设计模式中,都会有一个第三者来进行解耦.在生产者和消费者模式中,我们需要一个第三者来对此进行解耦</p>
</blockquote>
<h3 id="为什么要用生产者和消费者模式"><a href="#为什么要用生产者和消费者模式" class="headerlink" title="为什么要用生产者和消费者模式?"></a>为什么要用生产者和消费者模式?</h3><p>在线程世界里，<strong>生产者就是生产数据的线程，消费者就是消费数据的线程</strong>。在多线程开发当中，<br>如果生产者处理速度很快，而消费者处理速度很慢，那么生产者就必须等待消费者处理完，<br>才能继续生产数据。同样的道理，如果消费者的处理能力大于生产者，那么消费者就必须等待<br>生产者。为了解决这个问题于是引入了生产者和消费者模式。</p>
<h3 id="什么是生产者消费者模式"><a href="#什么是生产者消费者模式" class="headerlink" title="什么是生产者消费者模式"></a>什么是生产者消费者模式</h3><p>生产者消费者模式是通过一个容器来解决生产者和消费者的强耦合问题。生产者和消费者<br>彼此之间不直接通讯，而通过阻塞队列来进行通讯，所以生产者生产完数据之后不用等待<br>消费者处理，直接扔给阻塞队列，消费者不找生产者要数据，而是直接从阻塞队列里取，<br>阻塞队列就相当于一个缓冲区，平衡了生产者和消费者的处理能力。</p>
<p>这个阻塞队列就是用来给生产者和消费者解耦的。纵观大多数设计模式，都会找一个第三者出<br>来进行解耦，如工厂模式的第三者是工厂类，模板模式的第三者是模板类。在学习一些设计模<br>式的过程中，如果先找到这个模式的第三者，能帮助我们快速熟悉一个设计模式。</p>
<h3 id="单生产者单消费者"><a href="#单生产者单消费者" class="headerlink" title="单生产者单消费者"></a>单生产者单消费者</h3><p>一个生产者线程，一个消费者线程.过程看代码注释,非常详细了.希望我以后看见我的注释就能回想起一切.</p>
<p>资源类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">public class Resource &#123;</div><div class="line">    private int num = 0;</div><div class="line">    boolean flag = false;</div><div class="line"></div><div class="line">    public Resource(int num) &#123;</div><div class="line">        this.num = num;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">//    生产资源</div><div class="line">    public synchronized void createNum() &#123;</div><div class="line">//        flag为true表示有资源。那么生产者就不能生产了，生产者线程就开始wait等待</div><div class="line">        if (flag) &#123;</div><div class="line">            try &#123;</div><div class="line">                wait();</div><div class="line">            &#125; catch (InterruptedException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">//        如果到了这里，表示：生产者已经被唤醒了，那么意味着资源已经被消费了，生产者要开始生产了</div><div class="line">        num++;</div><div class="line">        System.out.println(Thread.currentThread().getName()+&quot; 生产者线程: ---&gt; &quot;+num);</div><div class="line">//        生产者生产完资源后，把flag标记为true.表示有资源了</div><div class="line">        flag = true;</div><div class="line">//        有资源后，生产者去唤醒消费者去消费资源</div><div class="line">        notify();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //    消费资源</div><div class="line">    public synchronized void destory() &#123;</div><div class="line">//        因为flag为true时候有资源，那么！flag表示没用资源了，因此消费者线程就需要等待了，等待生产者线程去生产资源</div><div class="line">        if (!flag) &#123;</div><div class="line">            try &#123;</div><div class="line">                wait();</div><div class="line">            &#125; catch (InterruptedException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">//        到了这里，说明消费者线程被生产者线程唤醒了，那么也意味着有资源了</div><div class="line">        System.out.println(Thread.currentThread().getName()+&quot; 消费者线程: ---&gt; &quot;+num);</div><div class="line">//        消费了数据，那么消费者就得把flag标记为false，表示没用数据了，提醒生产者得去生产数据了</div><div class="line">        flag = false;</div><div class="line">//        接下来就得去唤醒生产者去生产数据了</div><div class="line">        notify();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>生产者线程:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">public class Producer implements Runnable &#123;</div><div class="line">    private Resource resource;</div><div class="line"></div><div class="line">    public Producer(Resource resource) &#123;</div><div class="line">        this.resource = resource;</div><div class="line">    &#125;</div><div class="line">    @Override</div><div class="line">    public void run() &#123;</div><div class="line">        while (true) &#123;</div><div class="line">            try &#123;</div><div class="line">                Thread.sleep(10);</div><div class="line">            &#125; catch (InterruptedException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">            resource.createNum();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>消费者线程:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">public class Consumer implements Runnable &#123;</div><div class="line">    private Resource resource;</div><div class="line"></div><div class="line">    public Consumer(Resource resource) &#123;</div><div class="line">        this.resource = resource;</div><div class="line">    &#125;</div><div class="line">    @Override</div><div class="line">    public void run() &#123;</div><div class="line">        while (true) &#123;</div><div class="line">            try &#123;</div><div class="line">                Thread.sleep(10);</div><div class="line">            &#125; catch (InterruptedException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">            resource.destory();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>测试类:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">public class Test &#123;</div><div class="line">    public static void main(String[] args) &#123;</div><div class="line">        Resource resource = new Resource(50);</div><div class="line">        new Thread(new Producer(resource)).start();</div><div class="line">        new Thread(new Consumer(resource)).start();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">输出结果:</div><div class="line">Thread-0 生产者线程: ---&gt; 51</div><div class="line">Thread-1 消费者线程: ---&gt; 51</div><div class="line">Thread-0 生产者线程: ---&gt; 52</div><div class="line">Thread-1 消费者线程: ---&gt; 52</div><div class="line">Thread-0 生产者线程: ---&gt; 53</div><div class="line">Thread-1 消费者线程: ---&gt; 53</div><div class="line">Thread-0 生产者线程: ---&gt; 54</div><div class="line">Thread-1 消费者线程: ---&gt; 54</div><div class="line">Thread-0 生产者线程: ---&gt; 55</div><div class="line">Thread-1 消费者线程: ---&gt; 55</div><div class="line">Thread-0 生产者线程: ---&gt; 56</div><div class="line">Thread-1 消费者线程: ---&gt; 56</div></pre></td></tr></table></figure>
<p>单生产者和单消费者没有问题.</p>
<h3 id="多生产者多消费者"><a href="#多生产者多消费者" class="headerlink" title="多生产者多消费者"></a>多生产者多消费者</h3><blockquote>
<p>两个生产者两个消费者.生产者生产一个,消费者消费一个.</p>
</blockquote>
<p>测试代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">public class Test &#123;</div><div class="line">    public static void main(String[] args) &#123;</div><div class="line">        Resource resource = new Resource(0);</div><div class="line">        new Thread(new Producer(resource)).start();</div><div class="line">        new Thread(new Producer(resource)).start();</div><div class="line">        new Thread(new Consumer(resource)).start();</div><div class="line">        new Thread(new Consumer(resource)).start();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">输出:</div><div class="line"></div><div class="line">Thread-1 生产者线程: ---&gt; 105</div><div class="line">Thread-3 消费者线程: -----------&gt; 105</div><div class="line">Thread-2 消费者线程: -----------&gt; 105</div></pre></td></tr></table></figure>
<p>这里出现了问题.105生产了一次,消费了两次.<br>为了在做实验的时候,看出问题.我们不能把线程的等待时间设置得过长,不然可能没法暴露出问题.然后输出打印的时候,让消费者和生产者的输出格式不一样,是为了更快的定位到问题.<br>所以,在这里我修改了消费者的输出.所以会和上面的不太一样.</p>
<ul>
<li>原因分析<ul>
<li>当两个线程同时操作生产者生产或者消费者消费时，如果有生产者或者消费者的两个线程都wait()时，再次notify(),由于其中一个线程已经改变了标记而另外一个线程再次往下直接执行的时候没有判断标记而导致的。</li>
<li>if判断标记，只有一次，会导致不该运行的线程运行了。出现了数据错误的情况。</li>
</ul>
</li>
<li>解决方案<br>  +while判断标记，解决了线程获取执行权后，是否要运行！也就是每次wait()后再notify()时先再次判断标记</li>
</ul>
<p><strong>注意:</strong></p>
<ul>
<li>把单消费者单生产者改为多消费者和多生产者时候.<ul>
<li>1.把if改为while</li>
<li>2.把notify改为notifyAll(不然会出现锁死)</li>
</ul>
</li>
</ul>
<p>代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line">public class Resource &#123;</div><div class="line">    private int num = 0;</div><div class="line">    boolean flag = false;</div><div class="line"></div><div class="line">    public Resource(int num) &#123;</div><div class="line">        this.num = num;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">//    生产资源</div><div class="line">    public synchronized void createNum() &#123;</div><div class="line">//        flag为true表示有资源。那么生产者就不能生产了，生产者线程就开始wait等待</div><div class="line">        while (flag) &#123;</div><div class="line">            try &#123;</div><div class="line">                wait();</div><div class="line">            &#125; catch (InterruptedException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">//        如果到了这里，表示：生产者已经被唤醒了，那么意味着资源已经被消费了，生产者要开始生产了</div><div class="line">        num++;</div><div class="line">        System.out.println(Thread.currentThread().getName()+&quot; 生产者线程: ---&gt; &quot;+num);</div><div class="line">//        生产者生产完资源后，把flag标记为true.表示有资源了</div><div class="line">        flag = true;</div><div class="line">//        有资源后，生产者去唤醒消费者去消费资源</div><div class="line">//        notify();</div><div class="line">        notifyAll();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //    消费资源</div><div class="line">    public synchronized void destory() &#123;</div><div class="line">//        因为flag为true时候有资源，那么！flag表示没用资源了，因此消费者线程就需要等待了，等待生产者线程去生产资源</div><div class="line">        while (!flag) &#123;</div><div class="line">            try &#123;</div><div class="line">                wait();</div><div class="line">            &#125; catch (InterruptedException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">//        到了这里，说明消费者线程被生产者线程唤醒了，那么也意味着有资源了</div><div class="line">        System.out.println(Thread.currentThread().getName()+&quot; 消费者线程: -----------&gt; &quot;+num);</div><div class="line">//        消费了数据，那么消费者就得把flag标记为false，表示没用数据了，提醒生产者得去生产数据了</div><div class="line">        flag = false;</div><div class="line">//        接下来就得去唤醒生产者去生产数据了</div><div class="line">//        notify();</div><div class="line">        notifyAll();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>


          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/wei.png"
               alt="Hushiwei" />
          <p class="site-author-name" itemprop="name">Hushiwei</p>
           
              <p class="site-description motion-element" itemprop="description">时间渐行渐远</p>
          
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">25</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">16</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">26</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/Timehsw" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/HswTime" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hushiwei</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"hushiwei"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  













  
  

  

  

  

  


  

</body>
</html>
